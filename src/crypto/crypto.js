import { randomBytes } from "./noble/ciphers.js";
import { sha256 as _sha256 } from "./noble/hashes.js";
import * as uint8 from "../util/uint8.js";

export * as aes       from "./aes.js";
export * as derive    from "./derive.js";
export * as secp256k1 from "./secp256k1.js";
export * as ecdh      from "./ecdh.js";

// ============================================================================================================================ //
//  sha256()                                                                                                                    //
// ============================================================================================================================ //
export function sha256(arr) {
  return uint8.toHexa(sha256AsBinary(arr));
}

// ============================================================================================================================ //
//  sha256AsBinary()                                                                                                            //
// ============================================================================================================================ //
export function sha256AsBinary(arr) {
  if(!(arr instanceof Uint8Array)) {
    throw "Argument passed to compute sha256 is not an instance of Uint8Array";
  }
  return _sha256(arr);
}

// ============================================================================================================================ //
//  getRandomBytes()                                                                                                            //
// ============================================================================================================================ //
export function getRandomBytes(size) {
  return randomBytes(size);
}

// ============================================================================================================================ //
//  getRandomInteger()                                                                                                          //
// ============================================================================================================================ //
export function getRandomInteger(max) {
  let rand = getRandomBytes(6),
      v = 0;

  for(let i = 0; i < 6; i++) {
    v = v * 256 + rand[i];
  }

  return Math.floor(v / 2 ** 48 * max);
}

// ============================================================================================================================ //
//  generateKey256()                                                                                                            //
// ============================================================================================================================ //
export function generateKey256() {
  let key = randomBytes(32);

  return uint8.toHexa(key);
}
